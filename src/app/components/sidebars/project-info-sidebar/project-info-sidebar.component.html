<div class="flex flex-col gap-4 sm:gap-6 w-full">
  <app-team-card [team]="getTeamMembers()"></app-team-card>

  <p-card *ngIf="project.unfilledRoles && project.unfilledRoles.length > 0" class="w-full">
    <ng-template pTemplate="header">
      <div class="pt-3 sm:pt-4">
        <h4 class="text-sm sm:text-base font-bold text-800 dark:text-surface-0 text-center uppercase tracking-wide">Vagas Abertas</h4>
      </div>
    </ng-template>
    <ng-template pTemplate="content">
      <div class="flex flex-col gap-3 px-2 sm:px-3">
        <p-tag
          *ngFor="let role of project.unfilledRoles"
          [value]="role.name"
          severity="primary"
          class="w-full justify-center p-2 text-sm">
        </p-tag>

        <!-- Join Project Button -->
        <div class="mt-4" *ngIf="canJoinProject">
          <p-button
            label="Solicitar Participação"
            icon="pi pi-plus"
            styleClass="w-full"
            severity="success"
            (onClick)="openJoinModal()">
          </p-button>
        </div>
      </div>
    </ng-template>
  </p-card>

  <!-- Join Project Modal -->
  <p-dialog
    header="Solicitar Participação no Projeto"
    [(visible)]="showJoinModal"
    [modal]="true"
    [style]="{width: '500px'}"
    [closable]="!isSubmitting"
    [draggable]="false"
    [resizable]="false">

    <form [formGroup]="joinForm" (ngSubmit)="submitJoinRequest()">
      <div class="flex flex-col gap-4">

        <!-- Role Selection -->
        <div class="flex flex-col gap-2">
          <label for="roleId" class="flex items-start font-semibold">
            <i class="pi pi-users mr-2 mt-1 text-primary"></i>
            Função Desejada *
          </label>
          <p-select
            id="roleId"
            formControlName="roleId"
            [options]="availableRoles"
            optionLabel="name"
            optionValue="id"
            placeholder="Selecione uma função"
            class="w-full"
            [disabled]="isSubmitting">
          </p-select>
          <small
            class="p-error block"
            *ngIf="joinForm.get('roleId')?.invalid && joinForm.get('roleId')?.touched">
            Por favor, selecione uma função.
          </small>
        </div>

        <!-- Application Message -->
        <div class="flex flex-col gap-2">
          <label for="applicationMessage" class="flex items-start font-semibold">
            <i class="pi pi-comment mr-2 mt-1 text-primary"></i>
            Mensagem (Opcional)
          </label>
          <textarea
            pTextarea
            id="applicationMessage"
            formControlName="applicationMessage"
            placeholder="Conte um pouco sobre sua experiência e motivação para participar deste projeto..."
            rows="6"
            class="w-full p-3 border border-surface-border rounded-xl focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
            [disabled]="isSubmitting">
          </textarea>
          <small class="text-surface-500">Máximo 500 caracteres</small>
          <small
            class="p-error block"
            *ngIf="joinForm.get('applicationMessage')?.invalid && joinForm.get('applicationMessage')?.touched">
            A mensagem deve ter no máximo 500 caracteres.
          </small>
        </div>

        <!-- Submit Message -->
        <p-message
          *ngIf="submitMessage"
          [severity]="submitMessageType === 'success' ? 'success' : 'error'"
          [text]="submitMessage">
        </p-message>

        <!-- Support Link -->
        <div class="text-center">
          <p class="text-surface-500 dark:text-surface-400 text-xs">
            Em caso de bug ou dúvida,
            <a href="https://discord.gg/E5xy62Eus2" target="_blank" rel="noopener" class="text-primary-500 hover:text-primary-400 dark:text-primary-400 dark:hover:text-primary-300 font-medium hover:underline transition-colors">
              conte o suporte
            </a>
          </p>
        </div>

        <!-- Action Buttons -->
        <div class="flex justify-end gap-2 mt-4">
          <p-button
            label="Cancelar"
            severity="secondary"
            [text]="true"
            (onClick)="closeJoinModal()"
            [disabled]="isSubmitting">
          </p-button>
          <p-button
            label="Enviar Solicitação"
            type="submit"
            [loading]="isSubmitting"
            [disabled]="joinForm.invalid">
          </p-button>
        </div>
      </div>
    </form>
  </p-dialog>
</div>
